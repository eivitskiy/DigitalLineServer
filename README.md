# Сервер приложения Digital Line

## Введение

Этот сервер на основе docker-контейнеров служит для запуска тестового приложения [DigitalLine](https://github.com/eivitskiy/DigitalLine).

Он состоит из 3х контейнеров:

- [nginx](https://hub.docker.com/_/nginx) - [веб-сервер](https://nginx.org/ru/)
- [php-fpm](https://hub.docker.com/_/php) - менеджер просессов [FastCGI](https://www.php.net/manual/ru/install.fpm.php)
- [postgres](https://hub.docker.com/_/postgres) - СУБД [PostgreSQL](https://www.postgresql.org/)

## Требования

Для развёртывания сервера на машине должны быть установлены:

- docker
- docker-compose
- git (опционально)

## Установка и настройка

### Требуемое программное обеспечение

Для установки необходимых зависимостей в ubuntu-подобных системах можно использовать команду:

```bash
sudo apt update && sudo apt install docker docker-compose git 
```

### Клонирование репозитория

Создаём пустую папку для проекта и переходим в неё
```bash
mkdir DigitalLine && cd DigitalLine
```

Внутри папки выполним команду клонирования репозитория и перейдём внутрь новой папки
```bash
git clone git@github.com:eivitskiy/DigitalLineServer.git server && cd server
```

### Конфигурирование

Скопируем пример файла переменных окружения командой
```bash
cp .env.example .env
```

При необходимости изменить значения переменных окружения в файле `.env`

### Запуск

ПРИМЕЧАНИЕ! Предполагается что файлы самого приложения уже присутствуют. По-умолчанию файловая
структура следующая:
```
+ DigitalLine - основная директория проекта
|- server - директория сервера
| |- nginx - конфиги nginx'а
| |- php-fpm - конфиги php
| |- postgres - конфиги и данные postgres
|  \ ... прочие файлы
|
|- www - директория проекта турнирной таблицы
|  \ ... файлы проекта турнирной таблицы
| ...
```

Запуск контейнеров осуществляется командой

```bash
sudo docker-compose up -d
```

Также контейнеры можно запускать без прав суперпользователя, для этого пользователя
системы необходимо добавить в группу docker командой
```bash
sudo usermod -aG docker $USER
```
После добавления пользователя в группу потребуется сделать логаут.